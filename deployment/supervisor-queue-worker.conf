;==============================================================================
; Supervisor Configuration for Queue Workers
;==============================================================================
;
; Installation:
;   sudo cp deployment/supervisor-queue-worker.conf /etc/supervisor/conf.d/
;   sudo supervisorctl reread
;   sudo supervisorctl update
;   sudo supervisorctl start queue-worker-default:*
;
; Management:
;   sudo supervisorctl status                    # Check status
;   sudo supervisorctl restart queue-worker-default:*
;   sudo supervisorctl stop queue-worker-default:*
;   sudo supervisorctl tail -f queue-worker-default:queue-worker-default_00 stdout
;
; IMPORTANT: Update paths below to match your project!
;==============================================================================

;------------------------------------------------------------------------------
; Default Queue Worker (2 processes for parallel processing)
;------------------------------------------------------------------------------
[program:queue-worker-default]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/worker.php default 0 3
directory=/var/www/html
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/worker-default.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stopwaitsecs=3600
startsecs=5
startretries=3

;------------------------------------------------------------------------------
; High Priority Queue Worker (single process)
;------------------------------------------------------------------------------
[program:queue-worker-high]
process_name=%(program_name)s
command=php /var/www/html/worker.php high-priority 0 1
directory=/var/www/html
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/worker-high.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stopwaitsecs=3600
priority=999

;------------------------------------------------------------------------------
; Email Queue Worker (dedicated for email jobs)
;------------------------------------------------------------------------------
[program:queue-worker-emails]
process_name=%(program_name)s
command=php /var/www/html/worker.php emails 0 5
directory=/var/www/html
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/worker-emails.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stopwaitsecs=3600

;------------------------------------------------------------------------------
; Group for easy management
;------------------------------------------------------------------------------
[group:queue-workers]
programs=queue-worker-default,queue-worker-high,queue-worker-emails
priority=999
